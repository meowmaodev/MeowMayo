package com.mmdev.meowmayo.features.general;

import com.mmdev.meowmayo.config.HudManager;
import com.mmdev.meowmayo.config.settings.HudElementSetting;
import com.mmdev.meowmayo.utils.DelayUtils;
import com.mmdev.meowmayo.utils.events.S02ChatReceivedEvent;
import net.minecraft.client.gui.ScaledResolution;
import net.minecraft.client.renderer.GlStateManager;
import net.minecraftforge.client.event.RenderGameOverlayEvent;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraft.client.Minecraft;

import com.mmdev.meowmayo.config.ConfigSettings;
import com.mmdev.meowmayo.config.settings.ToggleSetting;
import com.mmdev.meowmayo.utils.ChatUtils;
import com.mmdev.meowmayo.utils.PlayerUtils;
import org.lwjgl.opengl.GL11;

public class InvulnerabilityItems {
    private ToggleSetting bMaskA = (ToggleSetting) ConfigSettings.getSetting("Bonzo's Mask Announcement");
    private ToggleSetting bMaskT = (ToggleSetting) ConfigSettings.getSetting("Bonzo's Mask Title");

    private ToggleSetting sMaskA = (ToggleSetting) ConfigSettings.getSetting("Spirit Mask Announcement");
    private ToggleSetting sMaskT = (ToggleSetting) ConfigSettings.getSetting("Spirit Mask Title");

    private ToggleSetting pPetA = (ToggleSetting) ConfigSettings.getSetting("Phoenix Pet Announcement");
    private ToggleSetting pPetT = (ToggleSetting) ConfigSettings.getSetting("Phoenix Pet Title");

    private HudElementSetting location = HudManager.getLocation("Invincibility Title");

    private String maskPop = null;

    @SubscribeEvent
    public void onChatPacket(S02ChatReceivedEvent event) {
        String msg = event.getMessage();

        if (Minecraft.getMinecraft().thePlayer == null) return;

        if (msg.endsWith("Bonzo's Mask saved your life!") && msg.startsWith("Your")) {
            if (bMaskA.getValue()) ChatUtils.partyChat("Bonzo's Mask Procced!");
            if (bMaskT.getValue()) {
                maskPop = "Bonzo Popped!";
                DelayUtils.scheduleTask(() -> { maskPop = null; }, 1500);
            }
        }

        if (msg.equals("Your Phoenix Pet saved you from certain death!")) {
            if (pPetA.getValue()) ChatUtils.partyChat("Phoenix Pet Procced!");
            if (pPetT.getValue()) {
                maskPop = "Phoenix Popped!";
                DelayUtils.scheduleTask(() -> { maskPop = null; }, 1500);
            }
        }

        if (msg.equals("Second Wind Activated! Your Spirit Mask saved your life!")) {
            if (sMaskA.getValue()) ChatUtils.partyChat("Spirit Mask Procced!");
            if (sMaskT.getValue()) {
                maskPop = "Spirit Popped!";
                DelayUtils.scheduleTask(() -> { maskPop = null; }, 1500);
            }
        }
    }

    @SubscribeEvent
    public void onRenderOverlay(RenderGameOverlayEvent.Text event) {
        if (maskPop == null || location == null) return;

        float scale = location.getScale();

        GlStateManager.pushMatrix();
        GlStateManager.translate(location.getX(), location.getY(), 0);
        GlStateManager.scale(scale, scale, 1.0f);

        Minecraft.getMinecraft().fontRendererObj.drawStringWithShadow(
                maskPop,
                0,
                0,
                0xFFFFFF
        );

        GlStateManager.popMatrix();
    }
}